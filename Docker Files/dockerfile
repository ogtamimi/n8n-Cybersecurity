FROM kalilinux/kali-rolling

USER root

# Update Kali
RUN apt update && apt upgrade -y

# Install dependencies for Node + n8n
RUN apt install -y curl sudo nano git python3 python3-pip build-essential

# Install Node.js 18 (recommended for n8n)
RUN curl -fsSL https://deb.nodesource.com/setup_18.x | bash - && \
    apt install -y nodejs

# Install stable n8n version (global install)
RUN npm install -g n8n@1.31.0

# Create n8n user with root rights
RUN useradd -m n8n && echo "n8n ALL=(ALL) NOPASSWD:ALL" >> /etc/sudoers

# Expose port for n8n UI
EXPOSE 5678

# Start n8n
CMD ["n8n"]
